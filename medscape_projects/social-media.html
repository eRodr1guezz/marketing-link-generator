<style>
  .tweet {
    -webkit-text-size-adjust: 100%;
    font-family: nunito-sans, sans-serif;
    color: #333;
    font-size: 1%;
    line-height: 100%;
    -webkit-box-direction: normal;
    box-sizing: border-box;
    width: 20%;
    margin: 20px 5px;
    padding: 60px 30px;
    background-color: #e8f0f4;
    text-align: left;
  }

  .user-avatar {
    width: 48px;
    height: 48px;
    clip-path: circle();
  }

  .social-media-wrapper {
    display: flex;
  }

  /* .tweet:hover {
    box-shadow: 0 1px 1px hsl(0deg 0% 0% / 0.075),
      0 2px 2px hsl(0deg 0% 0% / 0.075), 0 4px 4px hsl(0deg 0% 0% / 0.075),
      0 8px 8px hsl(0deg 0% 0% / 0.075), 0 16px 16px hsl(0deg 0% 0% / 0.075);
    transform: rotate(0.5deg);
  } */

  .like-btn {
    border: none;
  }

  .tweet-foot {
    justify-self: flex-end;
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    gap: 0.25rem;
  }
</style>

<script>
  window.addEventListener("DOMContentLoaded", async (e) => {
    let url = `https://effulgent-cocada-e3d151.netlify.app/.netlify/functions/get-tweets`;
    const devUrl = "http://localhost:9999/.netlify/functions/get-tweets";

    const response = await fetch(url, {
      headers: { "Content-Type": "application/json" },
    });

    const res = await response.json();

    // function getNextTweets(token) {
    //   if (!token) {
    //     return;
    //   }

    //   fetch(devUrl.concat(`/?token=${token}`), {
    //     headers: { "Content-Type": "application/json" },
    //   });
    // }

    const tweetWrapper = document.createElement("ul");
    tweetWrapper.className = "social-media-wrapper";

    console.log(res.data)

    const list = res.data.map((tw, i) => {
      const tweetText = document.createElement("li");
      const tweetContent = document.createElement("p");
      const tweetFooter = document.createElement("div");

      tweetText.className = "tweet";
      tweetContent.className = "tweet-content";
      tweetFooter.className = "tweet-foot";

      const linkRegex = /(?:(?:https?|ftp):\/\/)?[\w/\-?=%.]+\.[\w/\-&?=%.]+/g;

      const links = tw.text.matchAll(linkRegex);

      for (let val of links) {
        const link = val[0];
        const domLink = document.createElement("a");
        domLink.href = link;
        domLink.innerText = link;

        tweetFooter.appendChild(domLink);
      }

      tweetText.innerText = tw.text.replaceAll(linkRegex, "");

      const userAvatar = document.createElement("img");
      userAvatar.src = res.includes.users[i].profile_image_url;
      userAvatar.className = "user-avatar";

      tweetText.prepend(userAvatar);

      tweetText.appendChild(tweetFooter);

      return tweetText;
    });

    for (let i = 0; i < 5; i++) {
      tweetWrapper.appendChild(list[i]);
    }

    const socialMediaWrapper = document.querySelector(".social-media-wrapper");

    socialMediaWrapper.appendChild(tweetWrapper);

    // socialMediaWrapper.appendChild(nextTweetsButton);
  });
</script>

<main>
  <div class="container">
    <div class="social-media-wrapper"></div>
  </div>
</main>