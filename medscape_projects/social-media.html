<style>
  .user-avatar {
    width: 48px;
    height: 48px;
    clip-path: circle();
  }

  #social-container {
    margin-top: 3rem;
    /* background: rgb(0, 92, 139);
    background: linear-gradient(90deg,
        rgba(0, 92, 139, 1) 0%,
        rgba(65, 188, 201, 1) 100%); */
  }

  #social-media-wrapper {
    -webkit-font-smoothing: antialiased;
    width: 1200px;
    margin: 0 auto;
    display: block;
  }

  .tweet-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    align-items: flex-start;
    gap: 1.5rem;
  }

  .tweet {
    display: flex;
    flex-direction: column;
    background-color: rgba(65, 188, 201, 0.25);
    list-style: none;
    font-family: sans-serif;
    color: white;
    padding-bottom: 1rem;
  }

  .tweet-content {
    font-family: nunito-sans, sans-serif;
    font-weight: bold;
    text-align: left;
    /* margin-bottom: 30px; */
    padding: 2rem;
  }

  .tweet-media-header {
    width: auto;
  }

  .no-img-font {
    font-size: 22px;
  }

  /* .tweet:hover {
    box-shadow: 0 1px 1px hsl(0deg 0% 0% / 0.075),
      0 2px 2px hsl(0deg 0% 0% / 0.075), 0 4px 4px hsl(0deg 0% 0% / 0.075),
      0 8px 8px hsl(0deg 0% 0% / 0.075), 0 16px 16px hsl(0deg 0% 0% / 0.075);
    transform: rotate(0.5deg);
  } */

  .like-btn {
    border: none;
  }

  .tweet-foot {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    padding: 0.5rem 2rem;
    font-family: josefin-sans, sans-serif;
    font-weight: bold;
  }

  .twitter-icon {
    margin-left: auto;
    opacity: 0.25;
    width: 26px;
    height: 24px;
    background-image: url("https://uploads-ssl.webflow.com/629e47136630ca3f6cafa972/629e47136630ca07ebafa98d_ic-header-twitter.svg");
  }
</style>

<script>
  window.addEventListener("DOMContentLoaded", async (e) => {
    const url = `https://effulgent-cocada-e3d151.netlify.app/.netlify/functions/get-tweets`;
    const devUrl = "http://localhost:9999/.netlify/functions/get-tweets";

    const response = await fetch(url, {
      headers: { "Content-Type": "application/json" },
    });

    const res = await response.json();

    console.log(res);

    const wrapper = document.querySelector("#social-media-wrapper");
    const tweetGrid = document.querySelector(".tweet-grid");

    res.data.forEach((tw, i) => {
      if (i < 6) {

        const linkRegex = /(?:(?:https?|ftp):\/\/)?[\w/\-?=%.]+\.[\w/\-&?=%.]+/g;
        const links = tw.text.matchAll(linkRegex);

        // for (let val of links) {
        //   const link = val[0];
        //   const linkHtml = `<a href=${link}>${link}</a>`
        //   tweetFooter.append(linkHtml);
        // }

        const tweetBodyContent = tw.text.replaceAll(linkRegex, "");
        const tweet = document.createElement("li");
        const tweetFooter = document.createElement("footer");
        const tweetMediaHeader = document.createElement("img");
        const tweetContent = document.createElement("div");

        if (res.data[i].hasOwnProperty('attachments')) {
          tweetMediaHeader.src = res.includes.media.filter(
            (result) =>
              result.media_key === res.data[i].attachments.media_keys[0]
          )[0].url
        } else {
          tweetContent.classList.toggle('no-img-font')
        }

        tweetMediaHeader.className = "tweet-media-header";
        res.includes.users.filter((user) => user.id === res.data[i].author_id)[0]
          .profile_image_url;

        const tweetAvatar = document.createElement("img");
        tweetAvatar.className = "user-avatar";
        tweetAvatar.src = res.includes.users.filter(
          (user) => user.id === res.data[i].author_id
        )[0].profile_image_url;

        tweet.appendChild(tweetMediaHeader);

        tweet.className = "tweet";

        tweetContent.className = "tweet-content";
        tweetContent.innerText = tweetBodyContent;
        tweetMediaHeader.appendChild(tweetContent);

        const socialIcon = document.createElement("div");
        socialIcon.className = "twitter-icon";

        const userName = document.createElement("div");
        const timeStamp = document.createElement("div");

        timeStamp.innerText = "5 days ago";
        userName.appendChild(timeStamp);

        userName.className = "user-name";
        userName.innerText =
          "@" +
          res.includes.users.filter(
            (user) => user.id === res.data[i].author_id
          )[0].username;

        tweetFooter.appendChild(tweetAvatar);
        tweetFooter.className = "tweet-foot";
        tweetFooter.appendChild(userName);
        tweetFooter.appendChild(socialIcon);

        tweet.appendChild(tweetContent);
        tweetGrid.appendChild(tweet);
        tweet.appendChild(tweetFooter);
      }
    });

  });
</script>

<section id="social-container">
  <div id="social-media-wrapper">
    <ul class="tweet-grid"></ul>
  </div>
</section>