<style>
  .user-avatar {
    width: 48px;
    height: 48px;
    clip-path: circle();
  }

  #social-container {
    height: 100%;
    background: rgb(0, 92, 139);
    background: linear-gradient(90deg, rgba(0, 92, 139, 1) 0%, rgba(65, 188, 201, 1) 100%);
  }

  #social-media-wrapper {
    width: 1200px;
    margin: 0 auto;
    display: block;
  }

  .tweet-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 1.5rem;
  }

  li {
    display: flex;
    flex-direction: column;
    background-color: rgba(65, 188, 201, .25);
    list-style: none;
  }

  .tweet {
    font-family: sans-serif;
    padding: 2rem;
    color: white;
  }

  .tweet-content {
    text-align: center;
  }

  /* .tweet:hover {
    box-shadow: 0 1px 1px hsl(0deg 0% 0% / 0.075),
      0 2px 2px hsl(0deg 0% 0% / 0.075), 0 4px 4px hsl(0deg 0% 0% / 0.075),
      0 8px 8px hsl(0deg 0% 0% / 0.075), 0 16px 16px hsl(0deg 0% 0% / 0.075);
    transform: rotate(0.5deg);
  } */

  .like-btn {
    border: none;
  }

  .tweet-foot {
    justify-self: flex-end;
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    gap: 0.25rem;
  }
</style>

<script>
  window.addEventListener("DOMContentLoaded", async (e) => {
    const url = `https://effulgent-cocada-e3d151.netlify.app/.netlify/functions/get-tweets`;
    const devUrl = "http://localhost:9999/.netlify/functions/get-tweets";

    const response = await fetch(devUrl, {
      headers: { "Content-Type": "application/json" },
    });

    const res = await response.json();

    console.log(res)

    const wrapper = document.querySelector('#social-media-wrapper')
    const tweetGrid = document.querySelector('.tweet-grid')

    res.data.forEach((tw, i) => {
      const linkRegex = /(?:(?:https?|ftp):\/\/)?[\w/\-?=%.]+\.[\w/\-&?=%.]+/g;
      const links = tw.text.matchAll(linkRegex);

      // append links to the foot of the tweet
      // for (let val of links) {
      //   const link = val[0];
      //   const linkHtml = `<a href=${link}>${link}</a>`
      //   tweetFooter.append(linkHtml);
      // }

      //left off tuesday jun 14th 5:29pm on getting media attachments to head of tweet

      const tweetBodyContent = tw.text.replaceAll(linkRegex, "")
      const tweet = document.createElement('li')
      const tweetFooter = document.createElement('footer')
      const tweetMediaHeader = document.createElement('img')
      tweetMediaHeader.src = res.data[i].attachments.media_keys[0]

      tweetMediaHeader.className = 'tweet-media-header'
      res.includes.users.filter(user => user.id === res.data[i].author_id)[0].profile_image_url

      const tweetAvatar = document.createElement('img')
      tweetAvatar.className = 'user-avatar'
      tweetAvatar.src = res.includes.users.filter(user => user.id === res.data[i].author_id)[0].profile_image_url

      tweet.appendChild(tweetMediaHeader)

      tweet.className = 'tweet'
      const tweetContent = document.createElement('div')
      tweetContent.className = 'tweet-content'
      tweetContent.innerText = tweetBodyContent
      tweetMediaHeader.appendChild(tweetContent)
      tweetFooter.appendChild(tweetAvatar)


      tweet.appendChild(tweetContent)

      tweetGrid.appendChild(tweet)

      tweet.appendChild(tweetFooter)
      // userAvatar.src = res.includes.users[i].profile_image_url;

    });

    // for (let i = 0; i < 5; i++) {
    //   wrapper.appendChild(list[i]);
    // }
  });
</script>

<main id="social-container">
  <div id="social-media-wrapper">
    <ul class="tweet-grid">
    </ul>
  </div>
</main>