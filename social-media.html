<style>
  :root {
    --font-primary: Roboto, sans-serif;
  }

  main {
    font-family: var(--font-primary);
    width: 100%;
    height: 100%;
  }

  .tweet {
    border-radius: 8pt;
    color: #444;
    padding: 1rem;
    background-color: rgb(223, 246, 254);
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 1rem;
    margin: 1rem;
  }

  .user-avatar {
    width: 32px;
    height: 32px;
    clip-path: circle();
  }

  .container {
    display: flex;
    flex-direction: column;
    place-content: center;
    place-items: center;
  }

  .social-media-wrapper {
    border: solid 1px gray;
  }
</style>

<script>
  window.addEventListener("DOMContentLoaded", async (e) => {
    let url = `https://effulgent-cocada-e3d151.netlify.app/.netlify/functions/get-tweets`;
    const devUrl = "http://localhost:9999/.netlify/functions/get-tweets";

    const response = await fetch(devUrl, {
      headers: { "Content-Type": "application/json" },
    });

    const res = await response.json();

    function getNextTweets(token) {
      if (!token) {
        return;
      }

      fetch(devUrl.concat(`/?token=${token}`), {
        headers: { "Content-Type": "application/json" },
      });
    }

    const tweetWrapper = document.createElement("ul");

    const list = res.data.map((tw) => {
      const tweetText = document.createElement("li");
      tweetText.className = "tweet"
      tweetText.innerText = tw.text;

      const userAvatar = document.createElement('img');
      userAvatar.src = res.includes.users[0].profile_image_url;
      userAvatar.className = "user-avatar"
      tweetText.prepend(userAvatar)

      return tweetText;
    });

    for (let i = 0; i < list.length; i++) {
      tweetWrapper.appendChild(list[i]);
    }

    const socialMediaWrapper = document.querySelector(".social-media-wrapper");

    socialMediaWrapper.appendChild(tweetWrapper);
    const nextTweetsButton = document.createElement("button");

    nextTweetsButton.onclick = () => getNextTweets(res.meta.next_token);
    nextTweetsButton.innerText = "See More Tweets";

    socialMediaWrapper.appendChild(nextTweetsButton);
    

    socialMediaWrapper.append(res.includes.users[0].username);
  });
</script>

<main>
  <div class="container">
    <h1>Social Media Widget</h1>
    <div class="social-media-wrapper">Recent Tweets from @Medscape:</div>
  </div>
</main>
