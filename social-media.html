<style>
  html {
    height: 100%;
  }

  :root {
    --font-primary: Roboto, sans-serif;
    --color-secondary: rgb(71, 120, 136);
  }

  main {
    font-family: var(--font-primary);
    width: 100%;
    height: 100%;
  }

  .tweet {
    border-radius: 8pt;
    color: #444;
    padding: 30px;
    width: fit-content;
    background-color: rgba(0, 90, 139, .03);
    display: flex;
    align-items: flex-start;
    flex-direction: column;
    justify-content: space-between;
    gap: .75rem;
    margin: 1rem;
    transition: all 1s ease-in-out;
  }

  .user-avatar {
    width: 48px;
    height: 48px;
    clip-path: circle();
  }

  .social-media-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-auto-flow: row;
  }

  .tweet:hover {
    box-shadow:
      0 1px 1px hsl(0deg 0% 0% / 0.075),
      0 2px 2px hsl(0deg 0% 0% / 0.075),
      0 4px 4px hsl(0deg 0% 0% / 0.075),
      0 8px 8px hsl(0deg 0% 0% / 0.075),
      0 16px 16px hsl(0deg 0% 0% / 0.075);
    transform: rotate(.5deg);
  }

  .tweet-content {}

  .tweet-foot {
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    gap: .25rem;
  }

  a {
    color: var(--color-secondary);
    font-size: small;
    text-decoration: none;
  }

  a:hover .tweet-splash {
    background-image: url('https://pngimg.com/image/26975');
    background-repeat: no-repeat;
    /* position: absolute; */
    width: 200px;
    height: 200px;
  }
</style>

<script>
  window.addEventListener("DOMContentLoaded", async (e) => {
    let url = `https://effulgent-cocada-e3d151.netlify.app/.netlify/functions/get-tweets`;
    const devUrl = "http://localhost:9999/.netlify/functions/get-tweets";

    const response = await fetch(devUrl, {
      headers: { "Content-Type": "application/json" },
    });

    const res = await response.json();

    function getNextTweets(token) {
      if (!token) {
        return;
      }

      fetch(devUrl.concat(`/?token=${token}`), {
        headers: { "Content-Type": "application/json" },
      });
    }

    const tweetWrapper = document.createElement("ul");
    tweetWrapper.className = "social-media-wrapper"

    const list = res.data.map((tw) => {
      const tweetText = document.createElement("li");
      const tweetContent = document.createElement('p');
      const tweetFooter = document.createElement('div')

      tweetText.className = "tweet"
      tweetContent.className = "tweet-content"
      tweetFooter.className = "tweet-foot"

      const linkRegex = /(?:(?:https?|ftp):\/\/)?[\w/\-?=%.]+\.[\w/\-&?=%.]+/g

      const links = tw.text.matchAll(linkRegex)

      for (let val of links) {
        const link = val[0]
        const domLink = document.createElement('a')
        domLink.href = link
        domLink.innerText = link

        tweetFooter.appendChild(domLink)
      }

      tweetText.innerText = tw.text.replaceAll(linkRegex, '');

      const userAvatar = document.createElement('img');
      userAvatar.src = res.includes.users[0].profile_image_url;
      userAvatar.className = "user-avatar"
      tweetText.prepend(userAvatar)


      tweetText.appendChild(tweetFooter)

      return tweetText;
    });

    for (let i = 0; i < list.length; i++) {
      tweetWrapper.appendChild(list[i]);
    }

    const socialMediaWrapper = document.querySelector(".social-media-wrapper");

    socialMediaWrapper.appendChild(tweetWrapper);
    const nextTweetsButton = document.createElement("button");

    nextTweetsButton.onclick = () => getNextTweets(res.meta.next_token);
    nextTweetsButton.innerText = "See More Tweets";

    // socialMediaWrapper.appendChild(nextTweetsButton);


    socialMediaWrapper.append(res.includes.users[0].username);
  });
</script>

<main>
  <div class="container">
    <h1>Social Media Widget</h1>
    <div class="social-media-wrapper">Recent Tweets from @Medscape:</div>
  </div>
</main>